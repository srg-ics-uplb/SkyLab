{% extends '_layouts/base.html' %}
{% load crispy_forms_tags %}
{% load crispy_forms_filters %}
{% load staticfiles %}

{% block content %}
<div class='row'>
    <div class='col-sm-10 col-sm-offset-2'>
	<p>Howdy{% if user.is_authenticated %} {{ user.username }}{% endif %}!</p>

        <form id="ray-form" action="" method="post" enctype="multipart/form-data">

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Use Ray</h3>
            </div>
            <div class="panel-body">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#tab1">Basic Parameters</a></li>
                    <li><a data-toggle="tab" href="#tab2">Other Parameters</a></li>

                </ul>

                <div class="tab-content">
                    <div id="tab1" class="tab-pane fade in active">
                        {% crispy select_mpi_form %}
                        {{ input_formset.management_form }}

                        <div id="input-formset-container">
                            {% for form in input_formset.forms %}
                                {% crispy form %}
                            {% endfor %}
                        </div>
                        <div class="col-sm-12">
                            <br>
                            <input name="submit" value="Execute" type="submit" class="btn btn-primary btn-block">

                        </div>

                    </div>
                    <div id="tab2" class="tab-pane fade col-sm-12">
                        {% crispy other_parameter_form %}
                    </div>

                </div>


            </div>
        </div>
	</form>


    </div>
</div>

{% endblock %}

{% block js %}
    <script src="{% static 'jquery/js/jquery.formset.js' %}"></script>
    <script type="text/javascript">
        {#  edit how form_errors are displayed   #}
        $('.alert-block').addClass("col-sm-12");

        {# for dynamic formset add/remove        #}
        $(function () {
            $('.form-container').formset({
                prefix: '{{ input_formset.prefix }}',
                addText: 'Add input parameter'
            });
        })

        {# for parameter dropdown use-case abstraction; hide input_file2 if parameter != '-p'#}
        $('.panel-body').on('change', "select", function () {
            if (match = $(this).attr('name').match(/form-(\d+)-parameter/)) {
                inp_file2_div_id = '#div_id_form-' + match[1] + '-input_file2'
                parameter = $(this).val()
                if (parameter === "-p") {
                    $(inp_file2_div_id).show()
                    input_file2_label = 'id_form-' + match[1] + '-input_file2'
                    alert(input_file2_label)
                    alert($("label[for=input_file2_label]").text())
                } else {
                    $(inp_file2_div_id).hide()
                }


            }
        });




    </script>

{% endblock %}
